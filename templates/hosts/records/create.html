{% extends "base.html" %}
{% load i18n static %}

{% block title %}{{ host }} &mdash; {% trans "Create Record" %} &mdash; YDNS{% endblock %}

{% block header %}
	<link rel="stylesheet" type="text/css" href="{% static "css/select2.css" %}">
{% endblock %}

{% block content %}
	<div class="row">
	    <div class="col-lg-3">
            {% include "hosts/sidenav.html" %}
		</div>
	    <div class="col-lg-9">
			<section class="section">
				<h3 class="section-header page-header">
	                {% trans "Create Record" %}
	                <span class="pull-right">
					    <a href="#" class="btn btn-link">{% trans "Help" %}</a>
					</span>
	            </h3>
			    <form class="form-horizontal" method="post" action="{% url 'hosts:records:create' host.name %}">
			    	{% csrf_token %}
			    	<div class="form-group{% if errors.type %} has-error has-feedback{% elif post.type %} has-success has-feedback{% endif %}">
			    		<label for="id_type" class="col-lg-2 control-label">{% trans "Record Type" %}</label>
			    		<div class="col-lg-5">
			    			<select name="type" id="id_type" class="form-control" style="width:100%" data-placeholder="{% trans "Choose a typeâ€¦" %}">
			    				<option></option>
			    				{% for rr in supported_resource_types %}<option value="{{ rr.0 }}" data-title="{{ rr.1 }}"{% if post.type == rr.0 %} selected{% endif %}>{{ rr.0 }}</option>{% endfor %}
			    			</select>
                        	{% if errors.type %}<p class="help-block">{{ errors.type }}</p>{% endif %}
			    		</div>
			    	</div>
			    	<div class="form-group{% if errors.content %} has-error has-feedback{% elif post.content %} has-success has-feedback{% endif %}">
			    		<label for="id_content" class="col-lg-2 control-label">{% trans "Content" %}</label>
			    		<div class="col-lg-5">
			    			<input type="text" name="content" id="id_content" class="form-control" required maxlength="65535"{% if post.content %} value="{{ post.content }}"{% endif %}>
                        	{% if errors.content or post.content %}<i class="fa {{ errors.content|yesno:'fa-exclamation-triangle,fa-check-circle' }} feedback" aria-hidden="true"></i>{% endif %}
                        	{% if errors.content %}<p class="help-block">{{ errors.content|safe }}</p>{% endif %}
			    		</div>
			    	</div>
			    	<div class="form-group{% if post.type != 'MX' %} hidden{% endif %} fg-rr-mx{% if errors.ttl %} has-error has-feedback{% elif post.ttl %} has-success has-feedback{% endif %}">
			    		<label for="id_ttl" class="col-lg-2 control-label"><abbr title="{% trans "Time to live, in seconds" %}">{% trans "TTL" %}</abbr></label>
			    		<div class="col-lg-2">
			    			<input type="number" name="ttl" id="id_ttl" class="form-control" min="0" max="4294967296" required{% if post.ttl %} value="{{ post.ttl }}"{% else %} value="3600"{% endif %}>
                        	{% if errors.ttl or post.ttl %}<i class="fa {{ errors.ttl|yesno:'fa-exclamation-triangle,fa-check-circle' }} feedback" aria-hidden="true"></i>{% endif %}
                        	{% if errors.ttl %}<p class="help-block">{{ errors.ttl }}</p>{% endif %}
			    		</div>
			    	</div>
			    	<div class="form-group{% if post.type != 'MX' %} hidden{% endif %} fg-rr-mx{% if errors.prio %} has-error has-feedback{% elif post.prio %} has-success has-feedback{% endif %}">
			    		<label for="id_prio" class="col-lg-2 control-label">{% trans "Priority" %}</label>
			    		<div class="col-lg-2">
			    			<input type="number" name="prio" id="id_prio" class="form-control" min="1" max="4294967296" required{% if post.prio %} value="{{ post.prio }}"{% else %} value="20"{% endif %}>
                        	{% if errors.prio or post.prio %}<i class="fa {{ errors.prio|yesno:'fa-exclamation-triangle,fa-check-circle' }} feedback" aria-hidden="true"></i>{% endif %}
                        	{% if errors.prio %}<p class="help-block">{{ errors.prio }}</p>{% endif %}
			    		</div>
			    	</div>
			    	<div class="checkbox">
			    		<label class="col-lg-offset-2">
			    			<input type="checkbox" name="strict" value="strict"{% if not post or post.strict %} checked{% endif %}>
			    			{% trans "Strict validation of my input (recommended)" %}
			    		</label>
			    	</div>
			    	<div class="form-group">
			    		<div class="col-lg-offset-2 col-lg-9">
			    			<button type="submit" class="btn btn-primary">{% trans "Create Record" %}</button>
			    		</div>
			    	</div>
			    </form>
	        </section>
	    </div>
	</div>
{% endblock %}

{% block js %}
	<script type="text/javascript" src="{% static 'js/select2.min.js' %}"></script>
	<script type="text/javascript">
		$(function() {
			$('#id_type').select2({
				templateResult: function(data) {
					if (!data.disabled) {
						return '<strong>' + data.text + '</strong>' + '<br><span>' + $(data.element).data('title') + '</span>';
					} else {
						return data.text;
					}
				}
			});
			$('#id_type').on('change', function() {
				var val = $(this).val();
				console.log(val);

				if (val == 'MX') {
					$('.fg-rr-mx').removeClass('hidden');
				} else {
					$('.fg-rr-mx').addClass('hidden');
				}
			});
			$('[data-nav-id="hosts"],[data-nav-id="host-records"]').addClass('active');
		});
	</script>
{% endblock %}